<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>СУПЕР ПРИЗ! - РазводЛохов.ru</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --wheel-size-desktop: 350px;
      --wheel-size-tablet: 300px;
      --wheel-size-mobile: 260px; /* Увеличил немного для читаемости текста */

      /* Отступы для текста от центра колеса. Будет использоваться как translateY */
      --text-translate-y-desktop: -60px;
      --text-translate-y-tablet: -50px;
      --text-translate-y-mobile: -42px; /* Скорректировано для нового размера */

      --wheel-spin-duration: 7s;
      --current-text-translate-y: var(--text-translate-y-desktop); /* JS будет обновлять это */
    }

    body {
      margin: 0;
      padding: 15px; /* Добавил небольшой паддинг для всего body */
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(45deg, #0b0c10, #1a1d24, #0b0c10);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: #c5c6c7;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
      text-align: center;
    }

    @keyframes gradientBG { /* ... без изменений ... */ }
    .header-title { /* ... без изменений ... */ }
    @keyframes flicker-title { /* ... без изменений ... */ }
    .sub-title { /* ... без изменений ... */ }

    .wheel-container {
      position: relative;
      width: var(--current-wheel-size, var(--wheel-size-desktop)); /* JS будет обновлять --current-wheel-size */
      height: var(--current-wheel-size, var(--wheel-size-desktop));
      margin-bottom: 30px;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 3px solid #45a29e;
      background: conic-gradient(
        #ff00ff 0% 12.5%, #00ffff 12.5% 25%,
        #00ff00 25% 37.5%, #ffff00 37.5% 50%,
        #ff8000 50% 62.5%, #ff0000 62.5% 75%,
        #8000ff 75% 87.5%, #0080ff 87.5% 100%
      );
      box-shadow: 0 0 8px rgba(0,0,0,0.2), inset 0 0 10px rgba(0,0,0,0.4);
      transition: transform var(--wheel-spin-duration) cubic-bezier(0.25, 0.1, 0.25, 1);
      position: relative;
      transform: translateZ(0) rotate(0deg);
      will-change: transform;
    }

    .wheel-hub { /* ... без изменений ... */ }
    .wheel-lines { /* ... без изменений ... */ }
    .line-diag1, .line-diag2 { /* ... без изменений ... */ }

    .wheel-segment {
      position: absolute;
      width: 100%; height: 100%;
      top: 0; left: 0;
      transform-origin: center center;
      overflow: visible; /* Чтобы текст не обрезался, если выходит за формальные границы сегмента */
      z-index: 1;
      transform: translateZ(0);
      pointer-events: none; /* Сегменты не должны мешать кликам */
    }

    .wheel-segment .text-container {
        position: absolute;
        /* Размещаем контейнер текста в центре колеса */
        top: 50%;
        left: 50%;
        width: 1px; /* Минимальный размер, чтобы не влиял на layout */
        height: 1px;
        transform-origin: center center; /* Вращаем вокруг его собственного центра */
        display: flex;
        align-items: center;
        justify-content: center;
        /* Вращаем сам контейнер текста вместе с сегментом */
        /* transform: rotate(УГОЛ_СЕГМЕНТА_ДЛЯ_ТЕКСТА) будет установлен JS */
    }

    .wheel-segment .text-container span {
        display: block;
        position: absolute; /* Позиционируем абсолютно внутри text-container */
        transform-origin: center center;
        font-weight: bold;
        font-size: 0.75em; /* Базовый размер, адаптируется медиа-запросами */
        color: rgba(0,0,0,0.9);
        text-shadow: 0 0 2px white;
        line-height: 1.1;
        padding: 2px 3px;
        max-width: 90px; /* Ограничение ширины текста */
        text-align: center;
        white-space: normal; /* Разрешить перенос слов */
        /* Сдвигаем текст от центра и поворачиваем его, чтобы он был читаемым */
        /* translateY сдвинет его вдоль оси Y контейнера (который вращается) */
        /* rotate заставит сам текст быть горизонтальным */
        /* transform: translateY(var(--current-text-translate-y)) rotate(УГОЛ_АНТИВРАЩЕНИЯ_ТЕКСТА) будет установлен JS */
    }


    .pointer { /* ... без изменений ... */ }
    .btn-spin { /* ... без изменений ... */ }
    .result-popup { /* ... без изменений ... */ }
    .result-popup.show { /* ... без изменений ... */ }
    .result-popup h2 { /* ... без изменений ... */ }
    .result-popup p { /* ... без изменений ... */ }
    .result-popup .close-popup { /* ... без изменений ... */ }
    .result-popup .close-popup:hover { /* ... без изменений ... */ }
    .back-link { /* ... без изменений ... */ }
    .back-link:hover { /* ... без изменений ... */ }
    .stars-bg { /* ... без изменений ... */ }
    .star { /* ... без изменений ... */ }
    @keyframes twinkle-star-anim { /* ... без изменений ... */ }

    @media (max-width: 768px) {
      :root {
        --wheel-spin-duration: 6.5s;
        --current-text-translate-y: var(--text-translate-y-tablet);
      }
      .header-title { font-size: 2.5em; }
      .sub-title { font-size: 1.3em; }
      .wheel-container { width: var(--wheel-size-tablet); height: var(--wheel-size-tablet); }
      .wheel-segment .text-container span { font-size: 0.7em; max-width: 80px; }
      .pointer { top: -16px; border-left-width: 13px; border-right-width: 13px; border-top-width: 22px; }
      .btn-spin { font-size: 1.4em; padding: 14px 28px; }
      .result-popup h2 { font-size: 1.7em; }
      .result-popup p { font-size: 1.15em; }
    }

    @media (max-width: 480px) {
      :root {
        --wheel-spin-duration: 7s; /* Можно чуть дольше на мобильных для "ощущения" */
        --current-text-translate-y: var(--text-translate-y-mobile);
      }
      body { padding: 10px; }
      .header-title { font-size: 1.8em; }
      .sub-title { font-size: 1.1em; }
      .wheel-container { width: var(--wheel-size-mobile); height: var(--wheel-size-mobile); }
      .wheel-segment .text-container span { font-size: 0.68em; max-width: 75px; padding: 1px 2px; line-height: 1.05;}
      .pointer { top: -14px; border-left-width: 11px; border-right-width: 11px; border-top-width: 18px; }
      .btn-spin { font-size: 1.2em; padding: 11px 22px; }
      .result-popup { padding: 20px; }
      .result-popup h2 { font-size: 1.5em; }
      .result-popup p { font-size: 1em; }
      .back-link { font-size: 0.9em;}
    }
  </style>
</head>
<body>
  <div class="stars-bg" id="starsContainer"></div>

  <h1 class="header-title">ВАУ! ВЫ ВЫИГРАЛИ ПРИЗ!</h1>
  <p class="sub-title">Покрутите Колесо Удачи и Заберите Его!</p>

  <div class="wheel-container" id="wheelContainer">
    <div class="pointer"></div>
    <div class="wheel" id="prizeWheel">
      <div class="wheel-hub"></div>
      <div class="wheel-lines">
          <div class="line-diag1"></div>
          <div class="line-diag2"></div>
      </div>
      <!-- Сегменты генерируются JS -->
    </div>
  </div>

  <button class="btn-spin" id="spinButton">КРУТИТЬ!</button>
  <div class="result-popup" id="resultPopup"> <!-- ... без изменений ... --> </div>
  <a href="index.html" class="back-link">Вернуться на главную</a>

  <script>
    const wheelElement = document.getElementById('prizeWheel');
    const wheelContainer = document.getElementById('wheelContainer');
    const spinButton = document.getElementById('spinButton');
    const resultPopup = document.getElementById('resultPopup');
    const prizeResultText = document.getElementById('prizeResultText');
    const closeResultPopup = document.getElementById('closeResultPopup');
    const starsContainer = document.getElementById('starsContainer');
    const root = document.documentElement;

    const segmentPrizes = [
      "НИЧЕГО (ха-ха!)", "+1 LOH Coin", "Долг 1000 LOH",
      "Супер-ЛОХ Статус", "Бан на сайте", "Опять НИЧЕГО",
      "-5 LOH Coin", "Приз 'Утешение'"
    ];
    const numSegments = segmentPrizes.length;
    const segmentAngleDegrees = 360 / numSegments;

    let finalWheelRotation = 0;
    let isSpinning = false;

    function updateCurrentWheelSizeAndTextOffsetY() {
        let wheelSizeVar = '--wheel-size-desktop';
        let textOffsetYVar = '--text-translate-y-desktop';

        if (window.innerWidth <= 480) {
            wheelSizeVar = '--wheel-size-mobile';
            textOffsetYVar = '--text-translate-y-mobile';
        } else if (window.innerWidth <= 768) {
            wheelSizeVar = '--wheel-size-tablet';
            textOffsetYVar = '--text-translate-y-tablet';
        }
        
        const currentWheelSizeValue = getComputedStyle(root).getPropertyValue(wheelSizeVar).trim();
        root.style.setProperty('--current-wheel-size', currentWheelSizeValue);

        const currentTextOffsetYValue = getComputedStyle(root).getPropertyValue(textOffsetYVar).trim();
        root.style.setProperty('--current-text-translate-y', currentTextOffsetYValue);
    }


    function createSegments() {
        wheelElement.querySelectorAll('.wheel-segment').forEach(seg => seg.remove()); // Clear old segments if any
        const fragment = document.createDocumentFragment();
        updateCurrentWheelSizeAndTextOffsetY(); // Ensure CSS vars are set

        for (let i = 0; i < numSegments; i++) {
            const segmentDiv = document.createElement('div');
            segmentDiv.classList.add('wheel-segment');
            // Сегмент сам по себе не вращается статически, его положение определяется его порядком.
            // Вращается только всё колесо целиком.

            const textContainerDiv = document.createElement('div');
            textContainerDiv.classList.add('text-container');
            
            const span = document.createElement('span');
            span.textContent = segmentPrizes[i];
            
            textContainerDiv.appendChild(span);
            segmentDiv.appendChild(textContainerDiv);

            // Угол для поворота контейнера с текстом, чтобы он "смотрел" из центра наружу
            const textContainerAngle = i * segmentAngleDegrees + (segmentAngleDegrees / 2);
            textContainerDiv.style.transform = `rotate(${textContainerAngle}deg)`;

            // Угол для поворота самого текста, чтобы он стал горизонтальным
            // Он должен быть противоположен textContainerAngle
            const textSpanAngle = -textContainerAngle;
            // И сдвигаем его по оси Y контейнера (которая теперь направлена к краю колеса)
            span.style.transform = `translateY(var(--current-text-translate-y)) rotate(${textSpanAngle}deg)`;
            
            fragment.appendChild(segmentDiv);
        }
        wheelElement.appendChild(fragment);
    }
    
    spinButton.addEventListener('click', () => {
      if (isSpinning) return;
      isSpinning = true;
      spinButton.disabled = true;
      resultPopup.classList.remove('show');

      let randomFullSpins = (Math.floor(Math.random() * 6) + 10); // 10-15 spins for desktop
      if (window.innerWidth <= 768 && window.innerWidth > 480) { // Tablet
          randomFullSpins = (Math.floor(Math.random() * 5) + 12); // 12-16 spins
      } else if (window.innerWidth <= 480) { // Mobile
          randomFullSpins = (Math.floor(Math.random() * 5) + 15); // 15-19 spins for more visual rotation
      }
      randomFullSpins *= 360;

      const randomPartialSpin = Math.floor(Math.random() * 360);
      const targetRotation = finalWheelRotation + randomFullSpins + randomPartialSpin;
      
      finalWheelRotation = targetRotation;
      wheelElement.style.transform = `rotate(${finalWheelRotation}deg)`;

      const spinDurationMs = parseFloat(getComputedStyle(root).getPropertyValue('--wheel-spin-duration').trim()) * 1000;

      setTimeout(() => {
        isSpinning = false;
        // spinButton.disabled = false; 

        const normalizedAngle = (360 - (finalWheelRotation % 360)) % 360;
        let landedSegmentIndex = Math.floor(normalizedAngle / segmentAngleDegrees);
        landedSegmentIndex = Math.max(0, Math.min(numSegments - 1, landedSegmentIndex));

        const prizeWon = segmentPrizes[landedSegmentIndex];
        prizeResultText.textContent = `Вы выиграли: ${prizeWon}!`;
        resultPopup.classList.add('show');

        console.log(`Final Rotation: ${finalWheelRotation}, Norm Angle: ${normalizedAngle}, Index: ${landedSegmentIndex}, Prize: ${prizeWon}`);
        try {
            let mainPageScams = parseInt(localStorage.getItem('razvodLohovScamCount') || '0');
            localStorage.setItem('razvodLohovScamCount', mainPageScams + 1);
        } catch (e) { console.error("LS error:", e); }

      }, spinDurationMs + 100);
    });

    closeResultPopup.addEventListener('click', () => { /* ... без изменений ... */ });
    function createStars(count) { /* ... без изменений ... */ }

    // Инициализация
    window.addEventListener('resize', () => {
        // Пересоздаем сегменты при изменении размера, чтобы текст правильно позиционировался
        // с новыми значениями CSS переменных (особенно --current-text-translate-y)
        createSegments(); 
    });
    createSegments(); // Первоначальное создание сегментов
    createStars(30); // Уменьшил количество звезд для общей производительности

  </script>
</body>
</html>
