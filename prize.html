<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>СУПЕР ПРИЗ! - РазводЛохов.ru</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --wheel-size-desktop: 350px;
      --wheel-size-tablet: 300px;
      --wheel-size-mobile: 250px;

      /* Отступы для текста от центра колеса */
      --text-offset-desktop: 65px;
      --text-offset-tablet: 55px;
      --text-offset-mobile: 45px;

      --wheel-spin-duration: 7s; /* Длительность анимации вращения */
    }

    body {
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(45deg, #0b0c10, #1a1d24, #0b0c10);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: #c5c6c7;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
      text-align: center;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .header-title {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 3.2em;
      color: #ff00ff;
      text-shadow: 0 0 5px #fff, 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 30px #ff00ff, 0 0 40px #ff45a2, 0 0 70px #ff45a2;
      margin-bottom: 15px;
      animation: flicker-title 2s infinite alternate;
    }

    @keyframes flicker-title {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.02); }
    }

    .sub-title {
      font-size: 1.6em;
      color: #66fcf1;
      text-shadow: 0 0 3px #fff, 0 0 8px #66fcf1, 0 0 12px #66fcf1, 0 0 18px #45a29e;
      margin-bottom: 30px;
    }

    .wheel-container {
      position: relative;
      width: var(--wheel-size-desktop);
      height: var(--wheel-size-desktop);
      margin-bottom: 35px;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 3px solid #45a29e;
      background: conic-gradient(
        #ff00ff 0% 12.5%, #00ffff 12.5% 25%,
        #00ff00 25% 37.5%, #ffff00 37.5% 50%,
        #ff8000 50% 62.5%, #ff0000 62.5% 75%,
        #8000ff 75% 87.5%, #0080ff 87.5% 100%
      );
      box-shadow: 0 0 8px rgba(0,0,0,0.2), inset 0 0 10px rgba(0,0,0,0.4);
      transition: transform var(--wheel-spin-duration) cubic-bezier(0.25, 0.1, 0.25, 1); /* Standard ease-out, will stop more abruptly */
      /* Alternative for very slow stop: cubic-bezier(0, 0, 0, 1) or specific like cubic-bezier(0.33, 1, 0.68, 1) */
      position: relative;
      transform: translateZ(0) rotate(0deg); /* Initial rotation for JS */
      will-change: transform;
    }

    .wheel-hub {
        width: 18%; height: 18%; background: #0b0c10; border-radius: 50%;
        border: 2px solid #f9e900; box-shadow: 0 0 8px #f9e900, inset 0 0 4px rgba(0,0,0,0.5);
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3;
    }
    .wheel-lines { position: absolute; top:0; left:0; right:0; bottom:0; z-index: 2; pointer-events: none;}
    .line-diag1, .line-diag2 {
        position: absolute; background-color: rgba(0,0,0,0.25); z-index: 2;
        width: 2px; height: 100%; left: calc(50% - 1px); top: 0;
    }
    .line-diag1 { transform: rotate(45deg); }
    .line-diag2 { transform: rotate(-45deg); }


    .wheel-segment {
      position: absolute;
      width: 100%; height: 100%; /* Cover the whole wheel initially */
      top: 0; left: 0;
      transform-origin: center center;
      overflow: hidden; /* Important for clip-path */
      z-index: 1;
      transform: translateZ(0);
      will-change: transform;
    }

    .wheel-segment .text-wrapper {
        position: absolute;
        width: 50%; /* Half the wheel diameter */
        height: 100%; /* Full wheel height */
        top: 0;
        left: 50%; /* Start from center */
        transform-origin: left center; /* Pivot from the center of the wheel */
        display: flex;
        align-items: center;
        justify-content: flex-start; /* Align text towards the edge */
        padding-left: var(--text-offset-current, var(--text-offset-desktop)); /* Push text out */
        box-sizing: border-box;
    }

    .wheel-segment .text-wrapper span {
        display: block;
        font-weight: bold;
        font-size: 0.75em;
        color: rgba(0,0,0,0.9);
        text-shadow: 0 0 2px white;
        line-height: 1.1;
        padding: 2px;
        max-width: 100px;
        transform: rotate(90deg); /* Make text perpendicular to the radius line initially */
        transform-origin: center center;
        white-space: normal;
        text-align: center;
    }

    .pointer {
      position: absolute;
      top: -18px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; border-left: 15px solid transparent;
      border-right: 15px solid transparent; border-top: 25px solid #f9e900;
      filter: drop-shadow(0px -2px 5px rgba(249,233,0,0.8)); z-index: 10;
    }

    .btn-spin {
      padding: 16px 32px; font-size: 1.6em; font-weight: 700; font-family: 'Orbitron', sans-serif;
      color: #0b0c10; background: linear-gradient(135deg, #f9e900, #ffae00);
      border: none; border-radius: 10px; cursor: pointer;
      box-shadow: 0 0 10px #f9e900, 0 0 20px #ffae00, 0 4px 12px rgba(0,0,0,0.25), inset 0 0 7px rgba(255,255,255,0.6);
      transition: all 0.2s ease-out; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px;
    }
    .btn-spin:hover:not(:disabled) { transform: translateY(-2px) scale(1.03); }
    .btn-spin:active:not(:disabled) { transform: translateY(0px) scale(1); }
    .btn-spin:disabled { background: linear-gradient(135deg, #666, #444); color: #999; cursor: not-allowed; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); transform: scale(1); }

    .result-popup {
      position: fixed; top: 50%; left: 50%; width: 90%; max-width: 480px; box-sizing: border-box;
      transform: translate(-50%, -50%) scale(0.3) rotate(-5deg);
      background: linear-gradient(145deg, #2a3b4a, #111c24);
      border: 2px solid #66fcf1; border-radius: 12px; padding: 25px 30px;
      box-shadow: 0 0 25px rgba(102,252,241,0.35), 0 8px 30px rgba(0,0,0,0.4);
      z-index: 100; text-align: center; opacity: 0; visibility: hidden;
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s ease-out, visibility 0.5s;
    }
    .result-popup.show { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; visibility: visible; }
    .result-popup h2 { color: #f9e900; text-shadow: 0 0 7px #f9e900, 0 0 12px #f9e900; margin-top: 0; font-size: 2em; font-family: 'Orbitron', sans-serif; }
    .result-popup p { font-size: 1.3em; color: #e0e1e2; margin-bottom: 20px; line-height: 1.4; }
    .result-popup .close-popup {
      padding: 10px 22px; font-size: 1em; font-weight: bold; background: linear-gradient(135deg, #ff4b2b, #ff416c);
      color: white; border: none; border-radius: 7px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(255, 75, 43, 0.35);
    }
    .result-popup .close-popup:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(255, 75, 43, 0.5); }

    .back-link {
      display: inline-block; margin-top: 20px; color: #66fcf1; text-decoration: none; font-size: 1em;
      padding: 7px 13px; border: 1px solid #66fcf1; border-radius: 5px; transition: background-color 0.3s, color 0.3s;
    }
    .back-link:hover { background-color: #66fcf1; color: #0b0c10; text-shadow: none; }

    .stars-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
    .star {
      position: absolute; background-color: white; border-radius: 50%; animation: twinkle-star-anim linear infinite;
      transform: translateZ(0); will-change: transform, opacity;
    }
    @keyframes twinkle-star-anim {
      0% { opacity: 0; transform: translateY(0px) scale(0.5); }
      20% { opacity: 0.7; transform: translateY(-2px) scale(1); }
      80% { opacity: 0.7; transform: translateY(2px) scale(1); }
      100% { opacity: 0; transform: translateY(0px) scale(0.5); }
    }

    @media (max-width: 768px) {
      :root {
        --wheel-spin-duration: 6.5s;
      }
      .header-title { font-size: 2.5em; }
      .sub-title { font-size: 1.3em; }
      .wheel-container { width: var(--wheel-size-tablet); height: var(--wheel-size-tablet); }
      .wheel-segment .text-wrapper { padding-left: var(--text-offset-tablet); }
      .wheel-segment .text-wrapper span { font-size: 0.7em; }
      .pointer { top: -16px; border-left-width: 13px; border-right-width: 13px; border-top-width: 22px; }
      .btn-spin { font-size: 1.4em; padding: 14px 28px; }
      .result-popup h2 { font-size: 1.7em; }
      .result-popup p { font-size: 1.15em; }
    }

    @media (max-width: 480px) {
      :root {
        --wheel-spin-duration: 6s;
      }
      body { padding: 10px; }
      .header-title { font-size: 1.8em; }
      .sub-title { font-size: 1.1em; }
      .wheel-container { width: var(--wheel-size-mobile); height: var(--wheel-size-mobile); }
      .wheel-segment .text-wrapper { padding-left: var(--text-offset-mobile); }
      .wheel-segment .text-wrapper span { font-size: 0.65em; max-width: 70px; }
      .pointer { top: -14px; border-left-width: 11px; border-right-width: 11px; border-top-width: 18px; }
      .btn-spin { font-size: 1.2em; padding: 11px 22px; }
      .result-popup { padding: 20px; }
      .result-popup h2 { font-size: 1.5em; }
      .result-popup p { font-size: 1em; }
      .back-link { font-size: 0.9em;}
    }
  </style>
</head>
<body>
  <div class="stars-bg" id="starsContainer"></div>

  <h1 class="header-title">ВАУ! ВЫ ВЫИГРАЛИ ПРИЗ!</h1>
  <p class="sub-title">Покрутите Колесо Удачи и Заберите Его!</p>

  <div class="wheel-container">
    <div class="pointer"></div>
    <div class="wheel" id="prizeWheel">
      <div class="wheel-hub"></div>
      <div class="wheel-lines">
          <div class="line-diag1"></div>
          <div class="line-diag2"></div>
      </div>
      <!-- Сегменты генерируются JS -->
    </div>
  </div>

  <button class="btn-spin" id="spinButton">КРУТИТЬ!</button>

  <div class="result-popup" id="resultPopup">
    <h2>Поздравляем! (или нет)</h2>
    <p id="prizeResultText"></p>
    <button class="close-popup" id="closeResultPopup">Закрыть</button>
  </div>

  <a href="index.html" class="back-link">Вернуться на главную</a>

  <script>
    const wheelElement = document.getElementById('prizeWheel');
    const spinButton = document.getElementById('spinButton');
    const resultPopup = document.getElementById('resultPopup');
    const prizeResultText = document.getElementById('prizeResultText');
    const closeResultPopup = document.getElementById('closeResultPopup');
    const starsContainer = document.getElementById('starsContainer');
    const rootStyle = document.documentElement.style;

    const segmentPrizes = [
      "НИЧЕГО (ха-ха!)", "+1 LOH Coin (бесполезный)", "Долг в 1000 LOH Coin (вы нам должны!)",
      "Почётный статус 'Супер-ЛОХ'", "Бан на сайте (шутка... может быть)", "Опять НИЧЕГО (невезучий!)",
      "-5 LOH Coin (да, мы забираем!)", "Приз 'Утешение' (ещё одна порция обмана)"
    ];
    const numSegments = segmentPrizes.length;
    const segmentAngleDegrees = 360 / numSegments;

    let finalWheelRotation = 0; // Store the final rotation after a spin
    let isSpinning = false;

    function createSegments() {
        const fragment = document.createDocumentFragment();
        // Calculate angles for clip-path polygon
        // We need one point at the center, and two points on the circumference
        const angleRad = (segmentAngleDegrees * Math.PI) / 180;
        const polyX = 50 + 50 * Math.tan(angleRad / 2); // X coord for polygon point on circumference
                                                        // (relative to a square where 50,0 is top-center)

        for (let i = 0; i < numSegments; i++) {
            const segmentDiv = document.createElement('div');
            segmentDiv.classList.add('wheel-segment');
            
            // Clip-path for wedge shape
            // Polygon points: center (50% 50%), then two points on circumference defining the wedge
            // This is complex; for now, we'll use an overlay approach for text,
            // as true wedge text positioning with clip-path is very hard.
            // Instead, we rotate a container for the text.
            // segmentDiv.style.clipPath = `polygon(50% 50%, 50% 0%, ${polyX}% 0%)`;
            // segmentDiv.style.transform = `rotate(${i * segmentAngleDegrees}deg)`;


            const textWrapperDiv = document.createElement('div');
            textWrapperDiv.classList.add('text-wrapper');
            
            const span = document.createElement('span');
            span.textContent = segmentPrizes[i];
            
            textWrapperDiv.appendChild(span);
            segmentDiv.appendChild(textWrapperDiv);

            // Rotate the entire segment container (which contains the textWrapper)
            // to position the textWrapper correctly around the circle.
            // The textWrapper itself is oriented to point "outwards" from the center.
            const rotationForSegment = i * segmentAngleDegrees;
            segmentDiv.style.transform = `rotate(${rotationForSegment}deg)`;
            
            fragment.appendChild(segmentDiv);
        }
        wheelElement.appendChild(fragment);
        updateTextOffsetCSSVar();
    }
    
    function updateTextOffsetCSSVar() {
        let currentOffsetVarName = '--text-offset-desktop';
        if (window.innerWidth <= 768 && window.innerWidth > 480) {
            currentOffsetVarName = '--text-offset-tablet';
        } else if (window.innerWidth <= 480) {
            currentOffsetVarName = '--text-offset-mobile';
        }
        const offsetValue = getComputedStyle(document.documentElement).getPropertyValue(currentOffsetVarName).trim();
        rootStyle.setProperty('--text-offset-current', offsetValue);
    }


    spinButton.addEventListener('click', () => {
      if (isSpinning) return;
      isSpinning = true;
      spinButton.disabled = true;
      resultPopup.classList.remove('show');

      // Get current rotation from style (e.g., "rotate(360deg)")
      const currentTransform = window.getComputedStyle(wheelElement).transform;
      let currentAngle = 0;
      if (currentTransform !== 'none') {
          const matrix = currentTransform.match(/^matrix\((.+)\)$/);
          if (matrix) {
              const values = matrix[1].split(', ').map(parseFloat);
              currentAngle = Math.round(Math.atan2(values[1], values[0]) * (180 / Math.PI));
              // This gives -180 to 180. We need to add previous full rotations.
              // finalWheelRotation stores the total accumulated rotation.
              // So, the visual currentAngle is finalWheelRotation % 360.
              // For simplicity, we'll just add to finalWheelRotation.
          }
      }


      // Random number of full spins (e.g., 10 to 15)
      const randomFullSpins = (Math.floor(Math.random() * 6) + 10) * 360;
      // Random additional angle (0 to 359)
      const randomPartialSpin = Math.floor(Math.random() * 360);
      
      const targetRotation = finalWheelRotation + randomFullSpins + randomPartialSpin;
      
      finalWheelRotation = targetRotation; // Update the total rotation
      wheelElement.style.transform = `rotate(${finalWheelRotation}deg)`;

      const spinDurationMs = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--wheel-spin-duration')) * 1000;

      setTimeout(() => {
        isSpinning = false;
        // spinButton.disabled = false; // Re-enable if multiple spins are allowed

        // Determine the landed segment
        // Normalize the final rotation to be between 0 and 359.99...
        // The pointer is at the top (0 degrees).
        // A positive rotation of the wheel means the top segment moves clockwise.
        // So, if wheel rotated by `R` degrees, the segment that was at `-R` is now at the top.
        const normalizedAngle = (360 - (finalWheelRotation % 360)) % 360;
        
        // Find which segment this angle falls into.
        // Segment 0: 0 to angle-1
        // Segment 1: angle to 2*angle-1
        // etc.
        // Or more simply, the middle of segment `i` is at `i * segAngle + segAngle/2`
        // We need to find `i` such that `normalizedAngle` is closest to middle of segment `i`
        // or rather, which segment range `normalizedAngle` falls into.

        let landedSegmentIndex = Math.floor(normalizedAngle / segmentAngleDegrees);
        
        // Due to potential floating point inaccuracies or edge cases with % 360,
        // ensure index is within bounds.
        landedSegmentIndex = Math.max(0, Math.min(numSegments - 1, landedSegmentIndex));

        const prizeWon = segmentPrizes[landedSegmentIndex];
        prizeResultText.textContent = `Вы выиграли: ${prizeWon}!`;
        resultPopup.classList.add('show');

        console.log(`Final Rotation: ${finalWheelRotation}, Normalized Angle for Pointer: ${normalizedAngle}, Landed Index: ${landedSegmentIndex}, Prize: ${prizeWon}`);
        try {
            let mainPageScams = parseInt(localStorage.getItem('razvodLohovScamCount') || '0');
            localStorage.setItem('razvodLohovScamCount', mainPageScams + 1);
        } catch (e) { console.error("LS error:", e); }

      }, spinDurationMs + 100); // Wait for CSS transition to end + small buffer
    });

    closeResultPopup.addEventListener('click', () => {
      resultPopup.classList.remove('show');
    });

    function createStars(count) {
        const numStars = window.innerWidth <= 480 ? Math.floor(count / 2.5) : count;
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < numStars; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            const size = Math.random() * (window.innerWidth <= 480 ? 1.5 : 2.5) + 0.5;
            star.style.width = `${size}px`; star.style.height = `${size}px`;
            star.style.left = `${Math.random() * 100}%`; star.style.top = `${Math.random() * 100}%`;
            star.style.animationDuration = `${Math.random() * 5 + 4}s`;
            star.style.animationDelay = `${Math.random() * 5}s`;
            if (Math.random() < 0.1) {
                const colors = ['#ff00ff', '#00ffff', '#66fcf1'];
                star.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                if (size > 1) { star.style.boxShadow = `0 0 ${size*1.5}px ${star.style.backgroundColor}`; }
            }
            fragment.appendChild(star);
        }
        starsContainer.appendChild(fragment);
    }

    createSegments();
    createStars(35);
    window.addEventListener('resize', updateTextOffsetCSSVar);

  </script>
</body>
</html>
